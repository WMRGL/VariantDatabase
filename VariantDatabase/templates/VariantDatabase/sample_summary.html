<!--Sample Summary Page - displays variants, WC, history , reports etc   -->

{% extends 'VariantDatabase/base.html' %}

  {% block content %}

    <br>

    <div class="alert alert-info">
  		You are viewing information relating to sample:  <strong> {{ sample.name }} </strong> 
	</div>


   <ul class="nav nav-tabs">


	    <li class="active"><a data-toggle="tab" href="#variants">Variants</a></li>
	    <li><a data-toggle="tab" href="#vcf">VCF</a></li>
	    <li><a data-toggle="tab" href="#QC">QC</a></li>
	    <li><a data-toggle="tab" href="#history">History</a></li>
	    <li><a data-toggle="tab" href="#report">Report</a></li>

  	</ul>

  	<br>

  	<div class="tab-content">



  	<!--Variants Tab displays filtered variants -->
  	<div id="variants" class="tab-pane active">



	    <div class="alert alert-info">


	    <table class="table-condensed">

	    	<thead>

				<tr>
					<th> Frequency </th>
					<th> Consequence </th>
					<th>  </th>

				</tr>

			</thead>

			<tbody>

				<tr>

					<td>	  		
						<select id="frequency-select" name="simple">
							<option>All</option>
		  					<option>0.001</option>
		  					<option>0.01</option>
		  					<option>0.05</option>
						</select> 
					</td>

					<td>	  		
						<select id="conseq-select" name="simple">
		  					<option>All</option>
		  					<option>LOF</option>
		  					<option>LOFplus</option>
						</select> 
					</td>

					<td>	
						 <input type="button" class="btn btn-info" id='filter-button' value="Filter">




					</td>

				</tr>





			</tbody>
		</table>

		<hr>

		<strong> Variants: </strong> {{summary.total}} / {{total_summary.total}} | <strong> Missense:</strong> {{summary.missense_count}} / {{total_summary.missense_count}} | 
	    <strong> Indels </strong> {{summary.indel_count}} / {{total_summary.indel_count}} | <strong> LOF : </strong> {{summary.lof_count}} / {{total_summary.lof_count}} |
	    <strong> Synonymous </strong> {{summary.synonymous}} / {{total_summary.synonymous}}


		</div>


  		<table id="variant_table" class = 'table table-hover'>

	  	  	<thead>

				<tr>
					<th> Variant </th>
					<th> REF </th>
					<th> ALT </th>
					<th> Consequence </th>
					<th> Max_AF </th>
					<th> Genes </th>
					<th> Expand </th>

				</tr>

			</thead>

			<tbody>
				
					{% for variant in variants %}

						<tr>

							<td> {{ variant.chromosome }} {{ variant.position }} </td>
							<td>  {{ variant.ref|truncatechars:9 }} </td>
							<td>  {{ variant.alt|truncatechars:9 }} </td>
							<td>  {{ variant.worst_consequence }} </td>
							<td>  {{ variant.max_af }} </td>
							<td>  {% for gene in variant.get_genes %}

	       							{{ gene }} 

	      						  {% endfor %} 

	      					</td>

	      					<td>  <a href="#"  data-toggle="modal" data-target="#collapse{{forloop.counter}}"><span class="glyphicon glyphicon-plus"></span></a> </td>


	      					<!--Pop Up modal if clicked -->
							<div id="collapse{{forloop.counter}}" class="modal fade" role="dialog">
							  <div class="modal-dialog">
							    <!-- Modal content-->
							    <div class="modal-content">
							      <div class="modal-header">
							        <button type="button" class="close" data-dismiss="modal">&times;</button>
							        <h4 class="modal-title">Variant Detail</h4>
							      </div>
							      <div class="modal-body">
							        <p>{{variant}}</p>
							        <a href ="{% url 'variant_detail' pk_sample=sample.pk variant_hash=variant.variant_hash  %}"> View </a> 
							      </div>
							      <div class="modal-footer"> </div>
							   
							    </div>

							  </div>
							</div>

						</tr>

					{% endfor %}

			</tbody>

		</table>

		<ul class='pager'>
		  	 <span class="current">
	            Page {{ variants.number }} of {{ variants.paginator.num_pages }}.
	        </span>

	        {% if variants.has_previous %}
	             <li><a href="?page={{ variants.previous_page_number }}">Previous</a> </li>
	        {% endif %}

	        {% if variants.has_next %}
	          <li>  <a href="?page={{ variants.next_page_number }}">Next</a> </li>
	        {% endif %}
    	</ul>




  	</div>

  	<!--Variants Tab with link to VCF file -->
	<div id="vcf" class="tab-pane fade">

    	<div class="alert alert-info">
  			<a href= "{% url 'list_sample_variants' sample.pk  %}" class="btn btn-info" role="button">View VCF</a>
		</div>

	</div>

	<!--QC Tab with link to QC -->
	<div id="QC" class="tab-pane fade">

		<p> Sample QC goes here </p>

	</div>

	<!--History Tab with link to History -->
	<div id="history" class="tab-pane fade">

		<p> history </p>


	</div>


	<div id="report" class="tab-pane fade">

		<table class = 'table table-hover'>

	  	  	<thead>

				<tr>
					<th> Report ID </th>
					<th> Creation Date </th>
					<th> Status </th>
					<th> Author </th>
					<th> View </th>



				</tr>

			</thead>

			<tbody>

				{% for report in reports %}

				<tr>

					<td> {{report.pk}} </td>
					<td> {{report.get_creation_date }}</td>
					<td> {{report.get_status }}</td>
					<td> {{ report.get_author}}</td>
					<td> <a href="{% url 'view_sample_report' pk_sample=sample.pk pk_report=report.pk  %}"> View  </a></td>


				</tr>

				{% endfor %}


			</tbody>

		</table>

		<hr>



        <div class="panel panel-success">
        <div class="panel-heading">Reports</div>
        <div class="panel-body"> <form class="form-horizontal" method="post">{% csrf_token %}

            {{ form.as_p }}

        <br>

        <div class="form-actions">

            <button type="submit" class="btn btn-primary">Create New</button>

        </div>
    
        </form>



	</div>

</div>


<script>
$(document).ready(function(){
    $("#filter-button").click(function(){

    	var freq = document.getElementById("frequency-select").value;
    	var conseq = document.getElementById("conseq-select").value;
        location.href='?freq='+ freq + '&' +'consequence='+conseq;
        
    });
});
</script>
 
{% endblock %}  
  
  
 

  
  
